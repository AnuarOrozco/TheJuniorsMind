<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Juniors Mind</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #fff;
      color: #1a1a1a;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 2rem;
    }
    header h1 {
      font-weight: 600;
      font-size: 2.5rem;
      margin-bottom: 0.3rem;
    }
    header p {
      color: #666;
      font-weight: 300;
      margin-bottom: 2rem;
    }
    .search-bar {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }
    .search-bar input, .search-bar select {
      border-radius: 30px;
      padding: 0.6rem 1rem;
      border: 1px solid #ddd;
      width: 250px;
      outline: none;
      transition: 0.3s ease;
    }
    .search-bar input:focus, .search-bar select:focus {
      border-color: #000;
    }
    .post-card {
      border: 1px solid #eee;
      border-radius: 15px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      max-width: 600px;
      text-align: left;
      transition: all 0.3s ease;
    }
    .post-card:hover {
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
      transform: translateY(-3px);
    }
    .post-card h4 {
      font-weight: 600;
    }
    .post-card p {
      font-weight: 300;
      color: #444;
    }
    .badge {
      background-color: #000;
      color: #fff;
      border-radius: 20px;
      font-size: 0.8rem;
      padding: 0.3rem 0.8rem;
    }
    footer {
      margin-top: 3rem;
      font-size: 0.9rem;
      color: #888;
    }
  </style>
</head>
<body>
<header>
  <h1>The Juniors Mind</h1>
  <p>El espacio donde los desarrolladores crecen, comparten y aprenden juntos.</p>
  <div class="mb-3">
    <a href="login.html" class="btn btn-dark rounded-pill mx-1">Iniciar Sesi√≥n</a>
    <a href="register.html" class="btn btn-outline-dark rounded-pill mx-1">Crear Cuenta</a>
  </div>
</header>

<!-- Barra de b√∫squeda y filtro -->
<div class="search-bar">
  <input type="text" id="searchInput" placeholder="Buscar publicaciones...">
  <select id="categoryFilter">
    <option value="">Todas las categor√≠as</option>
  </select>
</div>

<!-- Contenedor de posts -->
<main id="postsContainer" class="w-100 d-flex flex-column align-items-center">
  <!-- Los posts se insertan din√°micamente -->
</main>

<footer>
  ¬© 2025 The Juniors Mind ‚Äî Creado por desarrolladores, para desarrolladores.
</footer>

<script>
  const postsContainer = document.getElementById("postsContainer");
  const searchInput = document.getElementById("searchInput");
  const categoryFilter = document.getElementById("categoryFilter");
  let posts = [];

  // üîπ Cargar posts desde el backend
  async function loadPosts() {
    try {
      const response = await fetch("http://localhost:8080/api/posts");
      posts = await response.json();

      // Para cada post, obtener autor y categor√≠a din√°micamente
      const enrichedPosts = await Promise.all(
        posts.map(async post => {
          try {
            const [author, category] = await Promise.all([
              fetch(`http://localhost:8080/api/users/${post.authorId}`).then(res => res.ok ? res.json() : null),
              fetch(`http://localhost:8080/api/categories/${post.categoryId}`).then(res => res.ok ? res.json() : null)
            ]);
            return { ...post, author, category };
          } catch {
            return post; // fallback si falla alguna petici√≥n
          }
        })
      );

      posts = enrichedPosts;
      renderPosts(posts);
    } catch (error) {
      console.error("‚ùå Error al cargar los posts:", error);
      postsContainer.innerHTML = "<p class='text-danger'>No se pudieron cargar las publicaciones.</p>";
    }
  }

  // üîπ Cargar categor√≠as para el filtro
  async function loadCategories() {
    try {
      const response = await fetch("http://localhost:8080/api/categories");
      if (!response.ok) throw new Error("Error HTTP");
      const categorias = await response.json();

      categoryFilter.innerHTML = `<option value="">Todas las categor√≠as</option>`;
      categorias.forEach(cat => {
        const option = document.createElement("option");
        option.value = cat.id;
        option.textContent = cat.name;
        categoryFilter.appendChild(option);
      });
    } catch (error) {
      console.error("‚ùå Error al cargar categor√≠as:", error);
    }
  }

  // üîπ Renderizar posts
  function renderPosts(filteredPosts) {
    postsContainer.innerHTML = "";
    if (filteredPosts.length === 0) {
      postsContainer.innerHTML = "<p class='text-muted mt-4'>No se encontraron publicaciones.</p>";
      return;
    }

    filteredPosts.forEach(post => {
      const card = document.createElement("div");
      card.classList.add("post-card");

      const authorName = post.author?.username || "Desconocido";
      const categoryName = post.category?.name || "Sin categor√≠a";
      const formattedDate = post.createdAt ? new Date(post.createdAt).toLocaleDateString() : "Fecha desconocida";

      card.innerHTML = `
        <h4>${post.title}</h4>
        <p class="text-muted mb-1">
          Publicado por <strong>${authorName}</strong> ‚Äî ${formattedDate}
        </p>
        <span class="badge mb-2">${categoryName}</span>
        <p>${post.content}</p>
        <a href="detalle.html?id=${post.id}" class="btn btn-sm btn-outline-dark rounded-pill">Leer m√°s</a>
      `;
      postsContainer.appendChild(card);
    });
  }

  // üîπ Filtrar posts
  function filterPosts() {
    const searchTerm = searchInput.value.toLowerCase();
    const category = categoryFilter.value;

    const filtered = posts.filter(post => {
      const matchesSearch =
        post.title.toLowerCase().includes(searchTerm) ||
        post.content.toLowerCase().includes(searchTerm) ||
        post.author?.username?.toLowerCase().includes(searchTerm);
      const matchesCategory = !category || post.category?.id == category;
      return matchesSearch && matchesCategory;
    });

    renderPosts(filtered);
  }

  // üîπ Eventos
  searchInput.addEventListener("input", filterPosts);
  categoryFilter.addEventListener("change", filterPosts);

  // üîπ Inicializaci√≥n
  loadCategories();
  loadPosts();
</script>

</body>
</html>
